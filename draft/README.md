Here are the instructions for running `generate_embeddings_per_pretrained_CLIP_model.ipynb` (notebook) and `load_embeddings_and_get_cosine_similarity.py` (Python script):

**1. Clone the Repository**
```bash
git clone <your-repo-url>
cd <repo-folder>
```

**2. Install Required Packages**
```bash
pip install -r requirements.txt
# Or, if requirements.txt is missing:
pip install kaggle transformers torch pillow tqdm
```

**3. Download the Dataset**
- Set up your Kaggle API credentials as described in the `README.md`.
- Run the relevant cells in `generate_embeddings_per_pretrained_CLIP_model.ipynb` to download and extract the Flickr8k dataset.

**4. Generate Embeddings**
- Open `generate_embeddings_per_pretrained_CLIP_model.ipynb` in Jupyter or VS Code.
- Run all cells to generate and save CLIP embeddings for images and captions in the `embeddings` folder.
- The output file generated by the Python script `generate_embeddings_per_pretrained_CLIP_model.ipynb` is:

  - **File Name:** `embeddings.json`
  - **Format:** JSON
  - **Content Structure:**  
    The file contains a dictionary where:
    - Each key is an image file name (e.g., `1234567890.jpg`).
    - Each value is another dictionary with:
      - `"image_embedding"`: A list representing the CLIP embedding for the image.
      - `"text_embeddings"`: A list of lists, where each inner list represents the CLIP embedding for a caption associated with the image.

    Example structure:
    ```json
    {
      "image1.jpg": {
        "image_embedding": [0.1, 0.2, 0.3, ...],
        "text_embeddings": [
          [0.4, 0.5, 0.6, ...],
          [0.7, 0.8, 0.9, ...]
        ]
      },
      "image2.jpg": {
        "image_embedding": [0.1, 0.2, 0.3, ...],
        "text_embeddings": [
          [0.4, 0.5, 0.6, ...],
          [0.7, 0.8, 0.9, ...]
        ]
      }
    }
    ```

**5. Compute Cosine Similarity**
- Run the script:
```bash
python load_embeddings_and_get_cosine_similarity.py
```
- This script will load the saved embeddings and compute cosine similarity as per its logic.
- This script generates three CSV files in the `similarity_scores` directory:

1. `img_to_text_similarity_results.csv`
   - **Columns:** `image_name`, `most_similar_image_name`, `cosine_similarity`, `is_correct`
   - **Content:** For each image, the most similar caption (from all captions) is found based on cosine similarity.

2. `text_to_img_similarity_results.csv`
   - **Columns:** `text_image_name`, `text_image_idx`, `most_similar_image_name`, `cosine_similarity`, `is_correct`
   - **Content:** For each caption, the most similar image is found based on cosine similarity.

3. `text_to_text_similarity_results.csv`
   - **Columns:** `text_image`, `text_image_idx`, `most_similar_text_key`, `cosine_similarity`, `is_image_correct`, `is_text_correct`
   - **Content:** For each caption, the most similar other caption is found (excluding itself), with correctness flags.

All files are in standard CSV format, with each row representing a similarity result as described above.
**Notes:**
- Ensure the `embeddings` directory exists after running the notebook.
- Adjust any paths in the code if your folder structure is different.

## TODOs for Merging `draft/*` with Main Directory

- [ ] Review and refactor import statements to avoid duplication or conflicts with main directory modules.
- [ ] Move or merge utility functions (e.g., `load_text_embeddings`, `load_image_embeddings`, `cosine_similarity`) with shared utilities in the main directory if they exist.
- [ ] Ensure consistent device handling (CPU/GPU) across the project.
- [ ] Replace hardcoded file paths (e.g., `embeddings.json`, `similarity_scores`) with configurable variables or use a project-wide config.
- [ ] Integrate logging and error handling as per main directory standards.
- [ ] Check for duplicate functionality in the main directory and remove or consolidate as needed.
- [ ] Update the main `README.md` and documentation to reflect merged functionality and usage.
- [ ] Add or merge unit tests for all new or changed functions.
- [ ] Ensure output file formats and locations are consistent with the rest of the project.
- [ ] Remove this TODO list after successful integration.